# MyFtp帮助文件V2.0
## 一、概述
* 版本：2.0
* 作者：刘江
* 日期：2016-7-14
* email：feixuelym@sina.com
* GitHub：[http://github.com/feixuelove1009](http://github.com/feixuelove1009)
* 解释器: Python3.5.1

## 二、版本升级说明
* 增加了日志系统。用户登录、退出以及上传和下载都会记录日志；
* 增加了删除目录和文件的功能；
* 增加了用户锁功能，防止重复登陆；
* 可以递归建立新文件夹了；
* 优化了文件传输机制，速度更快,显示下载速度等信息；
* 优化了部分代码，修复了一些bug；
* 改善了人机界面，提供了版本提示、连接提示、登陆提示等信息;
* readme文件开始用markdown书写；
* 调整了程序流程图。

## 三、主要功能
这是一个基于socketserver的FTP软件，分客户端和服务端两个部分，实现了
cd/dir/ls/mkdir/rm/du/get/put/help等核心命令。主要功能如下：
* 用户密码采用MD5加密；
* 允许多用户同时登录；
* 每个用户有自己的家目录
* 用户只能访问自己的家目录；
* 用户可以查看家目录内的文件；
* 用户可以在家目录内随意切换目录；
* 用户可以在家目录内随意新建目录；
* 用户可以在家目录内随意删除目录或文件；
* 对用户进行了磁盘配额，每个用户的可用空间不同；
* 可上传和下载文件，并进行MD5值校验，保证文件一致性；
* 文件传输过程中显示进度条；
* 支持文件的断点续传！
* 一个附加的服务器后台管理程序，用于添加、删除用户，修改用户密码和限额

## 四、文件目录结构
```
day10
MyFTP 2.0
│  readme.md                       # 帮助文件
│
├─MyFtp_client                      # ftp客户端
│  │  __init__.py
│  │
│  ├─bin
│  │      MyFtp_client.py           # 客户端启动模块
│  │      __init__.py
│  │
│  ├─conf
│  │  │  settings.py                # 客户端配置文件
│  │  │  __init__.py
│  │
│  ├─modules                        # 模块目录
│  │  │  client_argv_handler.py     # 客户端执行参数解析模块
│  │  │  MyFtp_client_core.py       # 客户端核心逻辑模块
│  │  │  __init__.py
│  │
│  └─var                            # ftp空间
│      │  __init__.py
│      │
│      └─users                      # 用户空间
│          │  __init__.py
│          │
│          └─alex                   # 用户alex的家目录
│              │
│              └─.tmp               # 临时文件存放目录

└─MyFtp_server                       # ftp服务器
    │  __init__.py
    │
    ├─bin
    │      MyFtp_server.py            # 服务器端启动文件
    │      __init__.py
    │
    ├─conf
    │  │  settings.py                # 服务器配置文件
    │  │  __init__.py
    │  │
    ├─db
    │      user.json                  # ftp用户信息文件
    │
    ├─modules
    │  │  manage_core.py             # 服务器后台管理模块
    │  │  MyFtp_server_core.py       # 服务器核心逻辑模块
    │  │  server_argv_handler.py     # 服务器运行参数处理模块
    │  │  __init__.py
    │  │
    │
    └─var
        └─log                       # 在服务器上的日志目录
            ├─download.log          # 文件下载记录
            ├─login.log             # 用户登录记录
            ├─logou.log             # 用户登出记录
            ├─upload.log            # 文件上传记录

        └─users                     # 在服务器上的用户家目录
            ├─alex                  # alex的家目录
            │  ├─.tmp              # alex的临时文件存储目录
            └─jack                  # jack的家目录
                └─.tmp              # jack的临时文件存储目录
   ```

## 五、数据结构
位于服务器端的db目录下的user.json文件保存了ftp用户的账户信息。这是
一个字典类型的json数据，每一个键值对是这样的：
用户名：{密码：md5值，磁盘限额：2}

## 六、测试用例
* 用户1：alex   密码：123
* 用户2：jack   密码：123
* 测试文件：   MyFtp_client/bin目录下的test3.jpg  6.3MB
               由于svn的原因，麻烦助教老师自行准备大型文件用于测试。
* 断点续传的测试：在传输过程中手动停止服务器或客户端程序，再启动并登陆

## 七、使用说明
代码是在windows的pycharm环境中进行编写和测试的。
1. 服务器ip_port=("0.0.0.0",6666)
* python3 MyFtp_server.py start      启动FTP服务器
* python3 MyFtp_server.py manage     启动FTP后台管理程序
2. 客户端连接服务器时，请务必先查询当前服务器的ip地址，端口请使用6666
* python3 MyFtp_client.py xxx.xxx.xxx.xxx:6666  启动FTP客户端
    注意：使用冒号连接ip和端口,客户端可同时开启多个。
3. ftp服务器运行期间提供了一定的信息提示，包括客户端断开连接、
上传下载md5码，显示日志信息等
4. ftp服务器后台管理程序用于添加、删除用户，修改用户密码和磁盘限额

5. ftp客户端功能说明：

    1. 登录：   客户端启动后需要登录验证，三次错误退出，成功则显示提示符
                [alex@192.168.1.100 \] ftp>
                格式：`[用户名@服务器ip当前路径] ftp>`
                当前路径会随着cd命令的变化而变化。
                不允许一个用户重复登陆

    2. dir：     查看目录，“/”代表用户家目录，可使用类似/test/test2/test3的绝对路径，
                 也可以使用../../test之类的相对路径。但是系统内部会判断路径是否处于用户
                 家目录内，如果不是，则提示路径错误。

    3. ls:       dir命令的复用

    4. cd：      路径切换，可使用绝对路径和相对路径，并限制在用户家目录内

    5. du：      查看用户磁盘限额，每次上传文件时进行空间容量判断，不足则不允许上传

    6. mkdir：   新建目录，可使用绝对路径和相对路径，并自动判断路径的正确与否，是否在
                 家目录内。支持多级递归建立！

    7. rm        删除文件或目录。如果将当前目录也一并删除了，程序会自动切换至根目录；

    8. get：     下载文件，可以get xxx或get xxx  yyy，自动判断绝对路径和相对路径，自动
                 判断文件是否存在，自动判断文件名的变化。

    9. put：     上传文件，可以put xxx或put xxx  yyy，自动判断绝对路径和相对路径，自动
                 判断文件是否存在，自动判断文件名的变化。

    10. 断点续传： 每次上传和下载文件时，在用户的家目录的.tmp文件夹内，建立一个以文件
                  MD5值为名的临时文件。正常任务完成时，将该文件复制到目标文件，并删除
                  该临时文件。当任务中途中断后，再继续执行该任务时，通过MD5值判断是否
                  有曾经传输过的临时文件，如果有，就从上次传输的后面继续传。

    11. 进度条显示： 通过对比已经传输的文件大小和总的文件大小，动态显示传输百分比。

    12. help：       帮助文档